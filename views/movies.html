<head>
  <style>
    table {
      font-family: arial, sans-serif;
      border-collapse: collapse;
      width: 100%;
    }

    td,
    th {
      border: 1px solid #dddddd;
      text-align: left;
      padding: 8px;
    }

    tr:nth-child(even) {
      background-color: #dddddd;
    }
  </style>
</head>

<h1>Hello</h1>
<table id="myTable">
  <thead>
    <tr>
      <th>id</th>
      <th>title</th>
      <th>year</th>
      <th>genre</th>
    </tr>
  </thead>
  <tbody>
    {{#movies}}
    <tr>
      <td>{{id}}</td>
      <td>{{title}}</td>
      <td>{{year}}</td>
      <td>{{genre}}</td>
    </tr>
    <!-- <div>{{title}}</div> -->

    {{/movies}}
  </tbody>

</table>
<script>
  // Get the table element
  var table = document.getElementById('myTable');

  // Attach double-click event listener to the table
  table.addEventListener('click', function (event) {
    // Check if the double-clicked element is a table row
    if (event.target.tagName.toLowerCase() === 'td') {
      // Get the parent row of the clicked cell
      var row = event.target.parentElement;

      // Get the index of the row
      var rowIndex = row.rowIndex;
      // Convert the row to an object

      // Display the index of the double-clicked row
      console.log('Double-clicked on row ' + rowIndex);
      //console.log(row.parentElement);
      function convertRowToObject(index) {
        // Get the table element
        var table = document.getElementById("myTable");
        // Get the rows in the table body
        var rows = table.getElementsByTagName("tbody")[0].getElementsByTagName("tr");
        // Get the table headers
        var headers = table.getElementsByTagName("thead")[0].getElementsByTagName("th");

        // Check if the index is valid
        if (index >= 0 && index < rows.length) {
          // Get the row at the specified index
          var row = rows[index];
          console.log(row.innerHTML);
          var rowData = {};
          // Iterate through each cell in the row
          for (var i = 0; i < headers.length; i++) {
            // Use the header text as the key and cell text as the value
            rowData[headers[i].innerText] = row.cells[i].innerText;
          }
          // Log the resulting object
          console.log(rowData);
          let ids = rowData.id
          console.log(ids)
          //need to post rowData to /movies/update

          const id = 123; // Example ID
const year = 2024; // Example year

// Construct the URL with query parameters
const url = `/movies/update?id=${id}&year=${year}`;
console.log("URL:", url); // Check the constructed URL

fetch(url, {
    method: "GET",
    headers: {
        "Content-Type": "application/json"
    },
    redirect: "follow"
})
.then(response => {
    if (!response.ok) {
        throw new Error('Network response was not ok');
    }
    return response.json();
})
.then(data => {
    console.log(data);
})
.catch(error => {
    console.error('There was a problem with your fetch operation:', error);
});


          //document.location.href="/movies_update"
        } else {
          console.error("Invalid index");
        }
      }
    }
    convertRowToObject(rowIndex - 1)
  });
</script>